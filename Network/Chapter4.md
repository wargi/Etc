#  Chapter 4: 라우팅 #

## 1. 주소와 경로

- IP 주소와 MAC 주소

  - IP주소와 MAC주소는 모두 수신처를 의미하지만 다른 부분이 있는데

    - IP주소는 최종 수신처를 결정
    - MAC주소는 같은 네트워크 내에서의 수신처를 결정

    > - IP주소 같은 경우 최종 목적지인 교대
    > - MAC주소 같은 경우에는 사당 -> 방배 -> 서초 -> 교대 이런식으로 한 정거장 정거장(경유지)을 MAC주소
    >
    > - 예를 들어, MAC주소가 다음 보낼 장소를 지정(사당역에서 방배역)하고 이것을 반복해서 최종역(IP주소)에 도달

- 경로

  - 라우터라는 장치가 '수신처까지의 경로'를 결정하는 역할을 한다. 하지만 모든 경로를 라우터가 결정하는 것이 아니라 '다음에 어디로 보내야 할지' 그 것만 결정한다.
  - 이렇게 반복해서 '다음 길'을 제시해 가는 방식을 홉 바이 홉(Hop-by-Hop)이라고 한다.

  > - 여기서 홉은 라우터를 가르키는 용어

  - 여기서 자주 나오는 수신처는 수신처에 가기 위한 다음 라우터를 말한다.
  - [중요] 라우터가 없으면 다른 네트워크에 데이터그램을 보낼 수 없다. 그래서 컴퓨터가 지정하는 라우터를 '디폴트 게이트웨이'라고 한다.

  > - 라우터가 라우팅 함으로써 다른 네트워크에 대한 '경로'가 생기는데, 이 '경로'가 없으면 다른 네트워크에 도달하지 못한다는 얘기와 동일

## 2. 라우터
- 라우터란?

  - 라우터란 어떤 네트워크에서 다른 네트워크에 데이터그램을 보내는 역할을 하고 '네트워크와 네트워크의 경계상'에 배치되기 때문에 복수의 인터페이스를 가질 수 있다.
  - 라우터의 인터페이스에는 논리 주소인 IP주소가 설정되어 있어서 라우터의 각 인터페이스는 각각의 네트워크에 소속되어 있는 형태
  - 라우팅: 데이터그램의 수신처 IP 주소를 근거로 다음에 송신하는 라우터를 결정
  - 또 다른 라우터의 역할으로는 복수의 네트워크끼리 연결하는 역할을 하는데 '복수의 네트워크'는 LAN으로 사용되는 이더넷인 경우나 WAN으로 사용되는 회선인 경우도 있다. 이렇게 다른 종류의 네트워크를 '연결'하는 것도 라우터의 역할 중 하나이다.
  - 라우터는 필터링이라는 처리도 하는데 여기서 필터링이란, 데이터그램에 조건을 붙여 파기하는 행위를 필터링이라고 한다.

  > -  예를 들어, 실습실에서 학과사무실로 데이터를 전송을 하지 못하게 한다던지 조건을 붙여 특정 데이터그램을 차단할 수 있게 한다.

- 라우터의 동작

  - 라우팅 테이블: 최적 경로의 지도라고 생각하면 이해하기 편한데, 라우터가 수신한 패킷이 수신처까지 도달하기 위한 최적의 경로가 그려진 지도라고 할 수 있다.

  > - 이 지도(라우팅 테이블)에는 수신처 네트워크까지의 거리, 다음에 도달하는 라우터, 그 라우터에 연결되어 있는 자신의 인터페이스등이 기재되어 있다.
  > - 이 전에 얘기한 다음 수신처를 정하는 것도 이 라우팅 테이블에 의해 정해진다.

  - 라우팅 테이블에서 다음 수신처를 찾아내는데 사용 하는 방식은 최장일치의 룰(Longest Match)이라고 불리는 규칙으로 결정된다.

  > - 이 규칙은 IP 주소의 비트열과 네트워크 주소의 비트열을 앞에서부터 순서대로 비교하여 가장 많이 일치하는 것부터 선택하는 방법이다. 그래서 비트열이 가장 많이 일치한걸 선택한다하여 최장일치의 룰이라고 불린다.

## 3. 디폴트 게이트웨이
- 브로드캐스트 도메인

  - 라우터의 기능

  > - 브로드캐스트는 라우터를 넘어 전송할 수 없는데 라우터가 네트워크를 나누기 때문에 브로드캐스트가 다른 네트워크에 송신되지 않도록 한다.
  > - 브로드캐스트가 도달하는 범위를 '브로드캐스트 도메인'이라고 하는데 라우터는 브로드 캐스트 도메인을 나눌 수 있다는 뜻으로 생각할 수 있다.
  >   - 충돌 도메인과 비슷하다고 생각이 드는데 충돌 영향이 미치는 범위는 충돌 도메인, 브로드캐스트가 미치는 범위가 브로드캐스트 도메인
  >   - 추가적으로, 충돌 도메인은 스위치가 구분하고, 브로드캐스트 도메인은 라우터가 구분한다라고 생각하니 이해하기 쉬웠다.

- ARP와 라우터

> - 상대방의 MAC주소를 알기 위해선 ARP가 필요하다.
> - 하지만, 같은 네트워크가 아니라면 ARP가 브로드캐스트인데 브로드캐스트는 라우터를 넘어 전송할 수 없다. 그러면 MAC주소를 얻을 수 없기 때문에 디폴트 게이트웨이를 이용하여 디폴트 게이트웨이의 MAC주소를 얻는다.
>   - 같은 네트워크라면 IP주소(최종 목적지)를 가지고 ARP를 수행한다.
> - 좀 더 자세히 설명하면 다른 네트워크로 전송하고 싶은 호스트는 일단 디폴트 게이트웨이로 데이터를 보내서 다른 네트워크로 전송한다. (즉, 송신측 컴퓨터가 최초로 데이터를 보내는 수신처는 디폴트 게이트웨이가 된다.)
> - IP는 최종 장소, MAC은 다음 장소라고 생각을 해보면 그럼 ARP는 디폴트 게이트웨이의 MAC주소를 가지고 ARP를 수행하게 된다.

## 4. 라우팅
-

## 5. 라우팅 프로토콜
-  

## 6. RIP
- 

## 7. ICMP
- 

## 8. Echo와 Time Exceeded
- 

## 9. Next Chapter Link
- [Chapter 5: 커넥션과 포트 번호](https://github.com/wargi/Etc/blob/master/Network/Chapter5.md)

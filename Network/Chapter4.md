#  Chapter 4: 라우팅 #

## 1. 주소와 경로

- IP 주소와 MAC 주소

  - IP주소와 MAC주소는 모두 수신처를 의미하지만 다른 부분이 있는데

    - IP주소는 최종 수신처를 결정
    - MAC주소는 같은 네트워크 내에서의 수신처를 결정

    > - IP주소 같은 경우 최종 목적지인 교대
    > - MAC주소 같은 경우에는 사당 -> 방배 -> 서초 -> 교대 이런식으로 한 정거장 정거장(경유지)을 MAC주소
    >
    > - 예를 들어, MAC주소가 다음 보낼 장소를 지정(사당역에서 방배역)하고 이것을 반복해서 최종역(IP주소)에 도달

- 경로

  - 라우터라는 장치가 '수신처까지의 경로'를 결정하는 역할을 한다. 하지만 모든 경로를 라우터가 결정하는 것이 아니라 '다음에 어디로 보내야 할지' 그 것만 결정한다.
  - 이렇게 반복해서 '다음 길'을 제시해 가는 방식을 홉 바이 홉(Hop-by-Hop)이라고 한다.

  > - 여기서 홉은 라우터를 가르키는 용어

  - 여기서 자주 나오는 수신처는 수신처에 가기 위한 다음 라우터를 말한다.
  - [중요] 라우터가 없으면 다른 네트워크에 데이터그램을 보낼 수 없다. 그래서 컴퓨터가 지정하는 라우터를 '디폴트 게이트웨이'라고 한다.

  > - 라우터가 라우팅 함으로써 다른 네트워크에 대한 '경로'가 생기는데, 이 '경로'가 없으면 다른 네트워크에 도달하지 못한다는 얘기와 동일

## 2. 라우터
- 라우터란?

  - 라우터란 어떤 네트워크에서 다른 네트워크에 데이터그램을 보내는 역할을 하고 '네트워크와 네트워크의 경계상'에 배치되기 때문에 복수의 인터페이스를 가질 수 있다.
  - 라우터의 인터페이스에는 논리 주소인 IP주소가 설정되어 있어서 라우터의 각 인터페이스는 각각의 네트워크에 소속되어 있는 형태
  - 라우팅: 데이터그램의 수신처 IP 주소를 근거로 다음에 송신하는 라우터를 결정
  - 또 다른 라우터의 역할으로는 복수의 네트워크끼리 연결하는 역할을 하는데 '복수의 네트워크'는 LAN으로 사용되는 이더넷인 경우나 WAN으로 사용되는 회선인 경우도 있다. 이렇게 다른 종류의 네트워크를 '연결'하는 것도 라우터의 역할 중 하나이다.
  - 라우터는 필터링이라는 처리도 하는데 여기서 필터링이란, 데이터그램에 조건을 붙여 파기하는 행위를 필터링이라고 한다.

  > -  예를 들어, 실습실에서 학과사무실로 데이터를 전송을 하지 못하게 한다던지 조건을 붙여 특정 데이터그램을 차단할 수 있게 한다.

- 라우터의 동작

  - 라우팅 테이블: 최적 경로의 지도라고 생각하면 이해하기 편한데, 라우터가 수신한 패킷이 수신처까지 도달하기 위한 최적의 경로가 그려진 지도라고 할 수 있다.

  > - 이 지도(라우팅 테이블)에는 수신처 네트워크까지의 거리, 다음에 도달하는 라우터, 그 라우터에 연결되어 있는 자신의 인터페이스등이 기재되어 있다.
  > - 이 전에 얘기한 다음 수신처를 정하는 것도 이 라우팅 테이블에 의해 정해진다.

  - 라우팅 테이블에서 다음 수신처를 찾아내는데 사용 하는 방식은 최장일치의 룰(Longest Match)이라고 불리는 규칙으로 결정된다.

  > - 이 규칙은 IP 주소의 비트열과 네트워크 주소의 비트열을 앞에서부터 순서대로 비교하여 가장 많이 일치하는 것부터 선택하는 방법이다. 그래서 비트열이 가장 많이 일치한걸 선택한다하여 최장일치의 룰이라고 불린다.

## 3. 디폴트 게이트웨이
- 브로드캐스트 도메인

  - 라우터의 기능

  > - 브로드캐스트는 라우터를 넘어 전송할 수 없는데 라우터가 네트워크를 나누기 때문에 브로드캐스트가 다른 네트워크에 송신되지 않도록 한다.
  > - 브로드캐스트가 도달하는 범위를 '브로드캐스트 도메인'이라고 하는데 라우터는 브로드 캐스트 도메인을 나눌 수 있다는 뜻으로 생각할 수 있다.
  >   - 충돌 도메인과 비슷하다고 생각이 드는데 충돌 영향이 미치는 범위는 충돌 도메인, 브로드캐스트가 미치는 범위가 브로드캐스트 도메인
  >   - 추가적으로, 충돌 도메인은 스위치가 구분하고, 브로드캐스트 도메인은 라우터가 구분한다라고 생각하니 이해하기 쉬웠다.

- ARP와 디폴트 게이트

> - 상대방의 MAC주소를 알기 위해선 ARP가 필요하다.
> - 하지만, 같은 네트워크가 아니라면 ARP가 브로드캐스트인데 브로드캐스트는 라우터를 넘어 전송할 수 없다. 그러면 MAC주소를 얻을 수 없기 때문에 디폴트 게이트웨이를 이용하여 디폴트 게이트웨이의 MAC주소를 얻는다.
>   - 같은 네트워크라면 IP주소(최종 목적지)를 가지고 ARP를 수행한다.
> - 좀 더 자세히 설명하면 다른 네트워크로 전송하고 싶은 호스트는 일단 디폴트 게이트웨이로 데이터를 보낸다. (즉, 송신측 컴퓨터가 최초로 데이터를 보내는 수신처는 디폴트 게이트웨이가 된다.)
> - 수신받은 디폴트 게이트웨이는 라우팅을 하고, 중계 라우터, 송신포트를 결정하여 다음에 수신받을 상대(중계 라우터 또는 수신처)에게 ARP를 수행한다.
> - ARP에 의해 입수한 MAC 주소를 수신처 MAC 주소로, 자기자신의 MAC 주소를 송신처 MAC 주소로 갱신하여 송신한다. (IP주소는 변경되지 않음)

## 4. 라우팅
- 라우팅 테이블

> - 라우팅 테이블: 수신처 네트워크, 중계 지점, 메트릭, 수신처의 출구가 기재되어 있는 표
> - 만약, 라우팅 테이블에 수신처 네트워크가 없을 때는 수신처 불명으로 데이터그램을 파기시킨다.

- 2개의 라우팅

> - 수신처 네트워크까지의 최적 경로를 어떻게 찾아낼까? 최적의 경로를 찾기 위해 다른 네트워크 경로를 모두 알아야 한다. (비교해 보지 않으면 어디가 최적의 경로인지 모르게 때문에)
> - 알고 있는 경로 중에서 최적의 경로를 선택하여 라우팅 테이블을 작성
> - 네트워크의 경로를 알 수 있는 방법에는 2가지가 있다.
>   1. 정적 라우팅
>   2. 동적 라우팅

- 정적 라우팅

> - 정적 라우팅은 관리자가 수동으로 경로를 입력해야 한다.
> - 하지만, 큰 단점을 가지고 있는데 정적 라우팅에서는 우회로 변경을 수동으로 수행할 필요가 있다. 
> - 예를 들면 수동으로 라우팅을 구성한 X라우터가 다음 라우터인 Z라우터에 장애가 생길 시에 Y라우터로 돌아가라고 관리자가 수동으로 우회로를 설정 해주어야 한다.
> - 하지만, 관리자가 언제 일어날지 모르는 장애를 대비하여 라우터 앞에 붙어 있어야 하기 때문에 대비하기 어려울 수 있다.

- 동적 라우팅

> - 동적 라우팅은 모든 경로 중에서 자동으로 최적의 경로를 선택해서 라우팅 테이블을 작성하는 것
>
> - 보기엔 좋은 점만 보이지만 단점도 있다.
>
>   1. 라우터끼리 정보를 교환한다는 것은 데이터를 서로 주고받는 것을 의미하는 것인데 그만큼 회선 전송을 압박하여 데이터 전송에 사용되는 분량이 줄어든다.(저속 회선을 사용하는 경우에는 주의가 필요)
>
>   2. 서로 교환한 정보를 가지고 최적의 경로를 계산해야 한다인데 그만큼 라우터의 처리능력이 필요하게 된다는 걸 의미하며 능력이 낮은 라우터의 경우에는 경로 계산에 치우치다 보면 데이터그램의 전송처리가 늦어지는 일이 생긴다.
>
>   3. 마지막으로 최대의 단점은 '모든 라우터가 동일한 정보를 가져야 한다'이다
>
>      > -  모든 라우터가 동일한 정보를 가지고 있는 상태를 '컨버전스(Convergence)'라고 말하는데, 네트워크의 라우터들은 컨버전스가 되어야 한다. (예를 들면, '여기에 장애가 있어요'나 '새로운 네트워크가 생겻어요'라는 정보 등을 라우터가 전부 가지고 있지 않으면 안 되기 때문에 '동일 정보'를 갖는다는 의미이다.)
>
> - 여러 가지 불편한 부분이 많지만, 그래도 자동으로 장애를 제거할 수 있다는라는 장점이 크기 때문에 많이 사용한다.(장애가 있다면 패킷이 전달되지 않기 때문)

## 5. 라우팅 프로토콜
-  자율화 시스템

> - 자율화 시스템(Autonomous System)
>
>   > 1. 하나의 관리 단체에 의해 관리되는 네트워크 집합체를 말한다.
>   > 2. 라우팅에서는 AS는 한 개의 범위로써 취급된다.
>   >    - 인터넷에서는 너무 많은 네트워크가 존재하기 때문에 같은 조직이 관리하는 복수의 네트워크를 AS로 통합
>   > 3. AS에는 식별하기 위한 유일한 번호가 부여되어 있다 (예) AS200)
>
> - 라우터는 동적 라우팅을 실현할 라우팅 프로토콜을 사용할 수 있도록 되어 있다.
>
> - 라우팅 프로토콜
>
>   > 근접해 있는 라우터 간의 네트워크 정보를 서로 교환하기 위한 규칙

-  라우팅 프로토콜의 종류

> - 앞에서 자율화 시스템(AS)를 설명한 이유는 라우팅 프로토콜이 크게 두가지 종류로 나뉜다는걸 이야기 하기 위해서이다.
>
>   > 1. AS 간 라우팅용(EGP: Exterior Gateway Protocol)
>   >    - EGP에서는 BGP라고 불리는 프로토콜이 표준이다.
>   > 2. AS 내부 라우팅용(IGP: Interior Gateway Protocol)
>   >    - IGP에서는 각각의 AS 관리자들이 맞춰서 프로토콜을 선택한다.

- 라우팅 프로토콜의 역할

> - 라우팅 프로토콜의 역할
>   1. 정보교환을 언제 할지
>   2. 어떻게 할지
>   3. 누구에게 전송할지
>   4. 어떤 정보를 전송할지
> - 라우팅 프로토콜의 위의 것들을 결정하면 정보를 교환해 컨버전스 상태에 도달한다.
> - 결론: 라우팅 프로토콜의 의해 라우팅 테이블이 만들어진다

## 6. RIP
- 메트릭

> - 메트릭이란 최적의 경로를 결정할 때의 판단 기준을 메트릭이라 한다.
> - 메트릭 값이란 중계하는 라우터의 수, 회선의 속도, 정체상태, 에러 발생률 등의 판단기준에 따라 라우팅 프로토콜에 의해 결정된 값을 계산해서 그 중 최소 값을 갖는 것을 최적의 경로로 결정한다.

- RIP

> - RIP(Routing Information Protocol)란 AS 내부의 프로토콜(IGP) 중 일부인 프로토콜로 디스턴스벡터 방식으로 동작한다.
>
> - 디스턴스벡터는 아래의 뜻을 가진다.
>
>   1. 디스턴스: 거리
>   2. 벡터: 방향
>
> - RIP 동작의 핵심이 '거리와 방향'이기 때문에 붙여진 이름이다.
>
> - RIP에서는 라우터와 라우터 끼리 정보(라우팅 테이블)를 교환하는 것을 '라우팅 업데이트'라고 부른다.(30초에 한번 정도)
>
> - 위에 설명 처럼 주기적으로 정보를 교환하면서 새로운 정보를 얻을 수 있으며 만약 6번 수신 받지 않으면 그 라우터에 뭔가 장애가 발생했다고 간주하고 그 라우터를 사용하는 경로를 파기해 버린다.
>
> - RIP에서는 메트릭에서 홉 수를 사용하는데 홉 수라는 것은 수신처 네트워크까지 통과 하는 라우터의 수를 말한다.
>
>   > - 간단 정리
>   >   - RIP는 업데이트를 수신하면, 자기가 모르는 네트워크를 라우팅 테이블에 추가하는 건데 그때, 업데이트를 보내 온 라우터를 그 앞의 네트워크의 중계 라우터로 설정, 업데이트를 받은 인터페이스를 그 앞의 네트워크의 송신 인터페이스로 정하도록 하는것.
>   >   - 이미 테이블이 존재하는 네트워크에 대해서는 새로운 정보가 업데이트 되어 새로운 경로 쪽이 메트릭이 작으면 그 쪽을 테이블에 기재한다. (새로운 경로 쪽의 메트릭이 크면 그 것은 무시한다.)
>   >   - 다시 한번 동작을 생각해보면 라우터가 있는 '방향 = 벡터' / 홉 수라는 '거리 = 디스턴스' [디스턴스벡터]

## 7. ICMP
- 

## 8. Echo와 Time Exceeded
- 

## 9. Next Chapter Link
- [Chapter 5: 커넥션과 포트 번호](https://github.com/wargi/Etc/blob/master/Network/Chapter5.md)
